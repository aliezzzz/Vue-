# 微信登陆授权认证

### 存在的问题
- Vue Router 存在两种路由模式，一种是hash模式，一种是history模式。
    - hash模式，在页面内以当前的路径直接调用接口，获得微信的回调时，因为hash模式以<b> # </b>字符作为页面路由的分隔，而微信以<b> # </b>字符作为路由的结束。从而微信会误判页面的路由，将处理好的页面路径放在<b> # </b>符号之前，从而使路由失效，无法跳转的正确的路径。
    - history模式，history模式无法通过路由进行直接的跳转，在地址栏中输入路径时，需要通过自定义的query参数对路由进行手动拦截，并且手动跳转路由，手动拦截在页面路径需要进行复杂跳转的时候会出现非常多的问题。最后路由的拦截会写的非常复杂啰嗦，极其容易出现问题。

### 解决方案
- 通过<b> auth.html?route= </b>来进入页面，实际的route以query参数的形式拼接在路径上
- 第一次进入页面时，获取到存在route参数，因为route经过encode过，所以只存在一个route参数
    - 将当前的location.href传到接口获取到微信链接（http://open.xxxxxxxxxxxxx）
    - 跳转到微信链接，微信会在传入的链接基础上拼接一个code参数
- 通过链接第二次进入页面，此时有两个参数，route和code，将route参数decode获取到实际需要跳转的链接和route中的query参数，再进行拼接处理出最终需要跳转的链接。